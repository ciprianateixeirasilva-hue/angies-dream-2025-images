<!doctype html>
<html lang="pt">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Angie’s Dream 2025 — Galeria</title>
  <style>
    :root{
      --bg:#0b0c0f;--card:#111318;--ink:#e9e9ee;--muted:#a6a7ad;--line:#232531;--accent:#6b8afd
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--ink);font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial}
    header{padding:20px 24px;border-bottom:1px solid var(--line);position:sticky;top:0;background:linear-gradient(180deg,#0b0c0fee 0%,#0b0c0fdd 60%,#0b0c0f00 100%);backdrop-filter:blur(6px);z-index:2}
    h1{margin:0;font-size:18px;letter-spacing:.3px}
    .toolbar{display:flex;gap:12px;align-items:center;margin-top:10px;flex-wrap:wrap}
    input[type="search"],select,button{background:#0f1116;color:var(--ink);border:1px solid var(--line);border-radius:10px;padding:10px 12px;font-size:14px}
    button{cursor:pointer}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:14px;padding:20px}
    .card{background:var(--card);border:1px solid var(--line);border-radius:14px;overflow:hidden;position:relative}
    .thumb{width:100%;height:320px;display:block;object-fit:cover;background:#0e1016}
    .cap{padding:10px 12px;border-top:1px dashed var(--line);font:12px/1.2 ui-monospace,Consolas,monospace;color:var(--muted);word-break:break-all}
    .chip{position:absolute;top:8px;left:8px;background:#0f1116cc;border:1px solid var(--line);color:var(--muted);font:10px ui-monospace;padding:4px 6px;border-radius:8px}
    .bad{position:absolute;inset:auto 8px 8px 8px;background:#2a1114;border:1px solid #5b1c24;color:#f7b3bd;padding:8px 10px;border-radius:10px;font:12px ui-monospace}
    footer{padding:20px;text-align:center;color:var(--muted);border-top:1px solid var(--line)}
    .empty{padding:40px;text-align:center;color:var(--muted)}
  </style>
</head>
<body>
  <header>
    <h1>Angie’s Dream 2025 — Galeria (auto)</h1>
    <div class="toolbar">
      <input id="q" type="search" placeholder="Filtrar por nome…" />
      <select id="ratio">
        <option value="cover" selected>Enquadrar: cover</option>
        <option value="contain">Enquadrar: contain</option>
      </select>
      <button id="reload" title="Recarregar da API">Recarregar</button>
    </div>
  </header>

  <main id="grid" class="grid"></main>
  <div id="empty" class="empty" style="display:none">Sem resultados…</div>
  <footer>Servido por GitHub Pages • Pasta: <code>/images</code> • Diferencia maiúsculas/minúsculas</footer>

  <script>
    // === CONFIGURAÇÃO DO TEU REPO ===
    const OWNER  = 'ciprianateixeirasilva-hue';
    const REPO   = 'angies-dream-2025-images';
    const BRANCH = 'main';
    const API_URL = `https://api.github.com/repos/${OWNER}/${REPO}/contents/images?ref=${BRANCH}`;
    const PAGES_BASE = `https://${OWNER}.github.io/${REPO}/`;

    const grid  = document.getElementById('grid');
    const q     = document.getElementById('q');
    const ratio = document.getElementById('ratio');
    const empty = document.getElementById('empty');
    const reloadBtn = document.getElementById('reload');

    const IMG_EXT = ['.jpg','.jpeg','.png','.gif','.webp','.avif'];
    let allFiles = [];

    async function fetchImages(){
      grid.innerHTML = '';
      empty.style.display = 'none';
      try{
        const res = await fetch(API_URL, { headers: { 'Accept':'application/vnd.github+json' } });
        if(!res.ok) throw new Error('Falha ao ler a API do GitHub');
        const data = await res.json();
        // Filtra apenas ficheiros de imagem
        allFiles = (Array.isArray(data) ? data : []).filter(x => x.type==='file' && IMG_EXT.some(ext => x.name.toLowerCase().endsWith(ext)) )
          .map(x => ({ name: x.name, url: PAGES_BASE + 'images/' + x.name }));
        render(allFiles);
      }catch(err){
        grid.innerHTML = `<div class="empty">Erro ao carregar lista de imagens. Confirma que a pasta <code>/images</code> existe no branch <code>${BRANCH}</code>.</div>`;
      }
    }

    function render(list){
      grid.innerHTML = '';
      if(!list.length){ empty.style.display = 'block'; return; }
      empty.style.display = 'none';
      list.forEach(({name, url}) => {
        const card = document.createElement('div');
        card.className = 'card';

        const chip = document.createElement('div');
        chip.className = 'chip';
        chip.textContent = name.split('.').pop().toUpperCase();

        const img = document.createElement('img');
        img.loading = 'lazy';
        img.decoding = 'async';
        img.alt = name;
        img.className = 'thumb';
        img.style.objectFit = ratio.value;
        img.src = url;
        img.addEventListener('error', () => {
          const bad = document.createElement('div');
          bad.className = 'bad';
          bad.textContent = `404: não encontrado → ${url}`;
          card.appendChild(bad);
        });

        const cap = document.createElement('div');
        cap.className = 'cap';
        cap.textContent = `images/${name}`;

        card.appendChild(chip);
        card.appendChild(img);
        card.appendChild(cap);
        grid.appendChild(card);
      });
    }

    q.addEventListener('input', () => {
      const term = q.value.trim().toLowerCase();
      render(allFiles.filter(f => f.name.toLowerCase().includes(term)));
    });

    ratio.addEventListener('change', () => {
      document.querySelectorAll('.thumb').forEach(el => el.style.objectFit = ratio.value);
    });

    reloadBtn.addEventListener('click', fetchImages);

    // Initial load
    fetchImages();
  </script>
</body>
</html>
